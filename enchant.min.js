/* enchant.js v0.5.2 http://enchantjs.com Licensed under MIT or GPLv3. (c) Ubiquitous Entertainment Inc. */
typeof Object.defineProperty!="function"&&(Object.defineProperty=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e}),typeof Object.defineProperties!="function"&&(Object.defineProperties=function(e,t){for(var n in t)t.hasOwnProperty(n)&&Object.defineProperty(e,n,t[n]);return e}),typeof Object.create!="function"&&(Object.create=function(e,t){function n(){}n.prototype=e;var r=new n;return t!=null&&Object.defineProperties(r,t),r}),typeof Object.getPrototypeOf!="function"&&(Object.getPrototypeOf=function(e){return e.__proto__}),typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments,1),r=function(){},i=function(){var i=n.concat(Array.prototype.slice.call(arguments));return t.apply(this instanceof r?this:e||window,i)};return r.prototype=t.prototype,i.prototype=new r,i});var enchant=function(e){e!=null&&(e instanceof Array||(e=Array.prototype.slice.call(arguments)),e=e.filter(function(e){return[e].join()})),function t(n,r){var i=[],s,o;for(var u in n)n.hasOwnProperty(u)&&(typeof n[u]=="function"?window[u]=n[u]:typeof n[u]=="object"&&Object.getPrototypeOf(n[u])===Object.prototype&&(e==null?i.push(u):(s=e.indexOf(r+u),s!==-1&&(i.push(u),e.splice(s,1)))));for(s=0,o=i.length;s<o;s++)t(n[i[s]],r+i[s]+".")}(enchant,"");if(e!=null&&e.length)throw new Error("Cannot load module: "+e.join(", "))};window.addEventListener("message",function(e,t){try{var n=JSON.parse(e.data);if(n.type==="event")enchant.Game.instance.dispatchEvent(new enchant.Event(n.value));else if(n.type==="debug")switch(n.value){case"start":enchant.Game.instance.start();break;case"pause":enchant.Game.instance.pause();break;case"resume":enchant.Game.instance.resume();break;case"tick":enchant.Game.instance._tick();break;default:}}catch(r){}},!1),enchant.Class=function(e,t){return enchant.Class.create(e,t)},enchant.Class.create=function(e,t){if(arguments.length===0)return enchant.Class.create(Object,t);if(arguments.length===1&&typeof arguments[0]!="function")return enchant.Class.create(Object,arguments[0]);for(var n in t)t.hasOwnProperty(n)&&(typeof t[n]=="object"&&Object.getPrototypeOf(t[n])===Object.prototype?"enumerable"in t[n]||(t[n].enumerable=!0):t[n]={value:t[n],enumerable:!0,writable:!0});var r=function(){if(!(this instanceof r))return new r;r.prototype.initialize.apply(this,arguments)};return r.prototype=Object.create(e.prototype,t),r.prototype.constructor=r,r.prototype.initialize==null&&(r.prototype.initialize=function(){e.apply(this,arguments)}),r},enchant.Class.getInheritanceTree=function(e){var t=[],n=e,r=n.prototype;while(n!==Object)t.push(n),r=Object.getPrototypeOf(r),n=r.constructor;return t},enchant.ENV={VENDOR_PREFIX:function(){var e=navigator.userAgent;return e.indexOf("Opera")!==-1?"O":e.indexOf("MSIE")!==-1?"ms":e.indexOf("WebKit")!==-1?"webkit":navigator.product==="Gecko"?"Moz":""}(),TOUCH_ENABLED:function(){var e=document.createElement("div");return e.setAttribute("ontouchstart","return"),typeof e.ontouchstart=="function"}(),RETINA_DISPLAY:function(){if(navigator.userAgent.indexOf("iPhone")!==-1&&window.devicePixelRatio===2){var e=document.querySelector('meta[name="viewport"]');return e==null&&(e=document.createElement("meta"),document.head.appendChild(e)),e.setAttribute("content","width=640"),!0}return!1}(),USE_FLASH_SOUND:function(){var e=navigator.userAgent,t=navigator.vendor||"";return location.href.indexOf("http")===0&&e.indexOf("Mobile")===-1&&t.indexOf("Apple")!==-1}(),USE_DEFAULT_EVENT_TAGS:["input","textarea","select","area"],CANVAS_DRAWING_METHODS:["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"],KEY_BIND_TABLE:{37:"left",38:"up",39:"right",40:"down"},PREVENT_DEFAULT_KEY_CODES:[37,38,39,40,32]},enchant.Event=enchant.Class.create({initialize:function(e){this.type=e,this.target=null,this.x=0,this.y=0,this.localX=0,this.localY=0},_initPosition:function(e,t){var n=enchant.Game.instance;this.x=this.localX=(e-n._pageX)/n.scale,this.y=this.localY=(t-n._pageY)/n.scale}}),enchant.Event.LOAD="load",enchant.Event.PROGRESS="progress",enchant.Event.ENTER_FRAME="enterframe",enchant.Event.EXIT_FRAME="exitframe",enchant.Event.ENTER="enter",enchant.Event.EXIT="exit",enchant.Event.CHILD_ADDED="childadded",enchant.Event.ADDED="added",enchant.Event.ADDED_TO_SCENE="addedtoscene",enchant.Event.CHILD_REMOVED="childremoved",enchant.Event.REMOVED="removed",enchant.Event.REMOVED_FROM_SCENE="removedfromscene",enchant.Event.TOUCH_START="touchstart",enchant.Event.TOUCH_MOVE="touchmove",enchant.Event.TOUCH_END="touchend",enchant.Event.RENDER="render",enchant.Event.INPUT_START="inputstart",enchant.Event.INPUT_CHANGE="inputchange",enchant.Event.INPUT_END="inputend",enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown",enchant.Event.LEFT_BUTTON_UP="leftbuttonup",enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown",enchant.Event.RIGHT_BUTTON_UP="rightbuttonup",enchant.Event.UP_BUTTON_DOWN="upbuttondown",enchant.Event.UP_BUTTON_UP="upbuttonup",enchant.Event.DOWN_BUTTON_DOWN="downbuttondown",enchant.Event.DOWN_BUTTON_UP="downbuttonup",enchant.Event.A_BUTTON_DOWN="abuttondown",enchant.Event.A_BUTTON_UP="abuttonup",enchant.Event.B_BUTTON_DOWN="bbuttondown",enchant.Event.B_BUTTON_UP="bbuttonup",enchant.Event.ADDED_TO_TIMELINE="addedtotimeline",enchant.Event.REMOVED_FROM_TIMELINE="removedfromtimeline",enchant.Event.ACTION_START="actionstart",enchant.Event.ACTION_END="actionend",enchant.Event.ACTION_TICK="actiontick",enchant.Event.ACTION_ADDED="actionadded",enchant.Event.ACTION_REMOVED="actionremoved",enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(e,t){var n=this._listeners[e];n==null?this._listeners[e]=[t]:n.indexOf(t)===-1&&n.unshift(t)},on:function(){this.addEventListener.apply(this,arguments)},removeEventListener:function(e,t){var n=this._listeners[e];if(n!=null){var r=n.indexOf(t);r!==-1&&n.splice(r,1)}},clearEventListener:function(e){e!=null?delete this._listeners[e]:this._listeners={}},dispatchEvent:function(e){e.target=this,e.localX=e.x-this._offsetX,e.localY=e.y-this._offsetY,this["on"+e.type]!=null&&this["on"+e.type](e);var t=this._listeners[e.type];if(t!=null){t=t.slice();for(var n=0,r=t.length;n<r;n++)t[n].call(this,e)}}}),function(){var e;enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(t,n){if(window.document.body===null)throw new Error("document.body is null. Please excute 'new Game()' in window.onload.");enchant.EventTarget.call(this);var r=!0;e&&(r=!1,e.stop()),e=enchant.Game.instance=this,this.width=t||320,this.height=n||320,this.scale=1;var i=document.getElementById("enchant-stage");if(!i)i=document.createElement("div"),i.id="enchant-stage",i.style.position="absolute",document.body.firstChild?document.body.insertBefore(i,document.body.firstChild):document.body.appendChild(i),this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height),this._pageX=0,this._pageY=0;else{var s=window.getComputedStyle(i);t=parseInt(s.width,10),n=parseInt(s.height,10),t&&n?this.scale=Math.min(t/this.width,n/this.height):(i.style.width=this.width+"px",i.style.height=this.height+"px");while(i.firstChild)i.removeChild(i.firstChild);i.style.position="relative";var o=i.getBoundingClientRect();this._pageX=Math.round(window.scrollX+o.left),this._pageY=Math.round(window.scrollY+o.top)}this.scale||(this.scale=1),i.style.fontSize="12px",i.style.webkitTextSizeAdjust="none",this._element=i,this.fps=30,this.frame=0,this.ready=null,this.running=!1,this.assets={};var u=this._assets=[];(function g(e){e.assets instanceof Array&&[].push.apply(u,e.assets);for(var t in e)e.hasOwnProperty(t)&&typeof e[t]=="object"&&Object.getPrototypeOf(e[t])===Object.prototype&&g(e[t])})(enchant),this._scenes=[],this.currentScene=null,this.rootScene=new enchant.Scene,this.pushScene(this.rootScene),this.loadingScene=new enchant.Scene,this.loadingScene.backgroundColor="#000";var a=this.width*.4|0,f=this.width*.05|0,l=a*.03|0,c=new enchant.Sprite(a,f);c.x=(this.width-a)/2,c.y=(this.height-f)/2;var h=new enchant.Surface(a,f);h.context.fillStyle="#fff",h.context.fillRect(0,0,a,f),h.context.fillStyle="#000",h.context.fillRect(l,l,a-l*2,f-l*2),c.image=h;var p=0,d=0;this.addEventListener("progress",function(e){p=e.loaded/e.total}),c.addEventListener("enterframe",function(){d*=.9,d+=p*.1,h.context.fillStyle="#fff",h.context.fillRect(l,0,(a-l*2)*d,f)}),this.loadingScene.addChild(c),this._mousedownID=0,this._surfaceID=0,this._soundID=0,this._intervalID=null,this._offsetX=0,this._offsetY=0,this.input={},this._keybind=enchant.ENV.KEY_BIND_TABLE||{};var v=0;["left","right","up","down","a","b"].forEach(function(e){this.addEventListener(e+"buttondown",function(t){var n;this.input[e]||(this.input[e]=!0,n=new enchant.Event(v++?"inputchange":"inputstart"),this.dispatchEvent(n)),this.currentScene.dispatchEvent(t),n&&this.currentScene.dispatchEvent(n)}),this.addEventListener(e+"buttonup",function(t){var n;this.input[e]&&(this.input[e]=!1,n=new enchant.Event(--v?"inputchange":"inputend"),this.dispatchEvent(n)),this.currentScene.dispatchEvent(t),n&&this.currentScene.dispatchEvent(n)})},this);if(r){i=enchant.Game.instance._element;var m;document.addEventListener("keydown",function(t){e.dispatchEvent(new enchant.Event("keydown")),enchant.ENV.PREVENT_DEFAULT_KEY_CODES.indexOf(t.keyCode)!==-1&&(t.preventDefault(),t.stopPropagation());if(!e.running)return;var n=e._keybind[t.keyCode];n&&(m=new enchant.Event(n+"buttondown"),e.dispatchEvent(m))},!0),document.addEventListener("keyup",function(t){if(!e.running)return;var n=e._keybind[t.keyCode];n&&(m=new enchant.Event(n+"buttonup"),e.dispatchEvent(m))},!0),enchant.ENV.TOUCH_ENABLED&&(i.addEventListener("touchstart",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0),i.addEventListener("touchmove",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0),i.addEventListener("touchend",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0)),i.addEventListener("mousedown",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e._mousedownID++,e.running||t.stopPropagation())},!0),i.addEventListener("mousemove",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0),i.addEventListener("mouseup",function(t){var n=t.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(n)===-1&&(t.preventDefault(),e.running||t.stopPropagation())},!0)}},preload:function(e){e instanceof Array||(e=Array.prototype.slice.call(arguments)),[].push.apply(this._assets,e)},load:function(t,n){n==null&&(n=function(){});var r=enchant.Game.findExt(t);if(enchant.Game._loadFuncs[r])enchant.Game._loadFuncs[r].call(this,t,n,r);else{var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(r){if(i.readyState===4){if(i.status!==200&&i.status!==0)throw new Error(i.status+": "+"Cannot load an asset: "+t);var s=i.getResponseHeader("Content-Type")||"";s.match(/^image/)?(e.assets[t]=enchant.Surface.load(t),e.assets[t].addEventListener("load",n)):s.match(/^audio/)?(e.assets[t]=enchant.Sound.load(t,s),e.assets[t].addEventListener("load",n)):(e.assets[t]=i.responseText,n())}},i.send(null)}},start:function(){if(this._intervalID)window.clearInterval(this._intervalID);else if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!e._touched&&enchant.ENV.VENDOR_PREFIX==="webkit"&&enchant.ENV.TOUCH_ENABLED){var t=new enchant.Scene;t.backgroundColor="#000";var n=Math.round(e.width/10),r=new enchant.Sprite(e.width,n);r.y=(e.height-n)/2,r.image=new enchant.Surface(e.width,n),r.image.context.fillStyle="#fff",r.image.context.font=n-1+"px bold Helvetica,Arial,sans-serif";var i=r.image.context.measureText("Touch to Start").width;r.image.context.fillText("Touch to Start",(e.width-i)/2,n-1),t.addChild(r),document.addEventListener("touchstart",function(){e._touched=!0,e.removeScene(t),e.start()},!0),e.pushScene(t);return}var s={},o=this._assets.filter(function(e){return e in s?!1:s[e]=!0}),u=0,a=o.length,f=function(){var t=new enchant.Event("progress");t.loaded=++u,t.total=a,e.dispatchEvent(t),u===a&&(e.removeScene(e.loadingScene),e.dispatchEvent(new enchant.Event("load")))};for(var l=0;l<a;l++)this.load(o[l],f);this.pushScene(this.loadingScene)}else this.dispatchEvent(new enchant.Event("load"));this.currentTime=Date.now(),this._intervalID=window.setInterval(function(){e._tick()},1e3/this.fps),this.running=!0},debug:function(){this._debug=!0,this.rootScene.addEventListener("enterframe",function(e){this._actualFps=1/e}),this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(){var e=Date.now(),t=new enchant.Event("enterframe");t.elapsed=e-this.currentTime,this.currentTime=e;var n=this.currentScene.childNodes.slice(),r=Array.prototype.push;while(n.length){var i=n.pop();i.age++,i.dispatchEvent(t),i.childNodes&&r.apply(n,i.childNodes)}this.currentScene.age++,this.currentScene.dispatchEvent(t),this.dispatchEvent(t),this.dispatchEvent(new enchant.Event("exitframe")),this.frame++},stop:function(){this._intervalID&&(window.clearInterval(this._intervalID),this._intervalID=null),this.running=!1},pause:function(){this._intervalID&&(window.clearInterval(this._intervalID),this._intervalID=null)},resume:function(){if(this._intervalID)return;this.currentTime=Date.now(),this._intervalID=window.setInterval(function(){e._tick()},1e3/this.fps),this.running=!0},pushScene:function(e){return this._element.appendChild(e._element),this.currentScene&&this.currentScene.dispatchEvent(new enchant.Event("exit")),this.currentScene=e,this.currentScene.dispatchEvent(new enchant.Event("enter")),this._scenes.push(e)},popScene:function(){return this.currentScene===this.rootScene?this.currentScene:(this._element.removeChild(this.currentScene._element),this.currentScene.dispatchEvent(new enchant.Event("exit")),this.currentScene=this._scenes[this._scenes.length-2],this.currentScene.dispatchEvent(new enchant.Event("enter")),this._scenes.pop())},replaceScene:function(e){return this.popScene(),this.pushScene(e)},removeScene:function(e){if(this.currentScene===e)return this.popScene();var t=this._scenes.indexOf(e);return t!==-1?(this._scenes.splice(t,1),this._element.removeChild(e._element),e):null},keybind:function(e,t){this._keybind[e]=t},getElapsedTime:function(){return this.frame/this.fps}}),enchant.Game._loadFuncs={},enchant.Game._loadFuncs.jpg=enchant.Game._loadFuncs.jpeg=enchant.Game._loadFuncs.gif=enchant.Game._loadFuncs.png=enchant.Game._loadFuncs.bmp=function(e,t){this.assets[e]=enchant.Surface.load(e),this.assets[e].addEventListener("load",t)},enchant.Game._loadFuncs.mp3=enchant.Game._loadFuncs.aac=enchant.Game._loadFuncs.m4a=enchant.Game._loadFuncs.wav=enchant.Game._loadFuncs.ogg=function(e,t,n){this.assets[e]=enchant.Sound.load(e,"audio/"+n),this.assets[e].addEventListener("load",t)},enchant.Game.findExt=function(e){var t=e.match(/\.\w+$/);return t&&t.length>0?t[0].slice(1).toLowerCase():e.indexOf("data:")===0?e.split(/[\/;]/)[1].toLowerCase():null},enchant.Game.instance=null}(),enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this),this._dirty=!1,this._x=0,this._y=0,this._offsetX=0,this._offsetY=0,this.age=0,this.parentNode=null,this.scene=null,this.addEventListener("touchstart",function(e){this.parentNode&&this.parentNode.dispatchEvent(e)}),this.addEventListener("touchmove",function(e){this.parentNode&&this.parentNode.dispatchEvent(e)}),this.addEventListener("touchend",function(e){this.parentNode&&this.parentNode.dispatchEvent(e)});var e=this.tl=new enchant.Timeline(this);this.addEventListener("enterframe",function(t){e.dispatchEvent(t)})},moveTo:function(e,t){this._x=e,this._y=t,this._updateCoordinate()},moveBy:function(e,t){this._x+=e,this._y+=t,this._updateCoordinate()},x:{get:function(){return this._x},set:function(e){this._x=e,this._updateCoordinate()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._updateCoordinate()}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y),this._dirty=!0},remove:function(){this._listener&&this.clearEventListener(),this.parentNode&&this.parentNode.removeChild(this)}}),enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){var e=enchant.Game.instance;enchant.Node.call(this),this._rotation=0,this._scaleX=1,this._scaleY=1,this._originX=null,this._originY=null,this._width=0,this._height=0,this._backgroundColor=null,this._opacity=1,this._visible=!0,this._buttonMode=null,this._style={},this.buttonMode=null,this.buttonPressed=!1,this.addEventListener("touchstart",function(){if(!this.buttonMode)return;this.buttonPressed=!0;var t=new enchant.Event(this.buttonMode+"buttondown");this.dispatchEvent(t),e.dispatchEvent(t)}),this.addEventListener("touchend",function(){if(!this.buttonMode)return;this.buttonPressed=!1;var t=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(t),e.dispatchEvent(t)});var t=this,n=new enchant.Event("render"),r=function(){t.dispatchEvent(n)};this.addEventListener("addedtoscene",function(){r(),e.addEventListener("exitframe",r)}),this.addEventListener("removedfromscene",function(){e.removeEventListener("exitframe",r)})},width:{get:function(){return this._width},set:function(e){this._width=e,this._dirty=!0}},height:{get:function(){return this._height},set:function(e){this._height=e,this._dirty=!0}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e}},opacity:{get:function(){return this._opacity},set:function(e){this._opacity=e}},visible:{get:function(){return this._visible},set:function(e){this._visible=e}},touchEnabled:{get:function(){return this._touchEnabled},set:function(e){this._touchEnabled=e}},intersect:function(e){return this._offsetX<e._offsetX+e.width&&e._offsetX<this._offsetX+this.width&&this._offsetY<e._offsetY+e.height&&e._offsetY<this._offsetY+this.height},within:function(e,t){t==null&&(t=(this.width+this.height+e.width+e.height)/4);var n;return(n=this._offsetX-e._offsetX+(this.width-e.width)/2)*n+(n=this._offsetY-e._offsetY+(this.height-e.height)/2)*n<t*t},scale:function(e,t){t==null&&(t=e),this._scaleX*=e,this._scaleY*=t,this._dirty=!0},rotate:function(e){this._rotation+=e,this._dirty=!0},scaleX:{get:function(){return this._scaleX},set:function(e){this._scaleX=e,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(e){this._scaleY=e,this._dirty=!0}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation=e,this._dirty=!0}},originX:{get:function(){return this._originX},set:function(e){this._originX=e,this._dirty=!0}},originY:{get:function(){return this._originY},set:function(e){this._originY=e,this._dirty=!0}}}),enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(e,t){enchant.Entity.call(this),this.width=e,this.height=t,this._image=null,this._frameLeft=0,this._frameTop=0,this._frame=0,this._frameSequence=[],this.addEventListener("enterframe",function(){if(this._frameSequence.length!==0){var e=this._frameSequence.shift();e===null?this._frameSequence=[]:(this._setFrame(e),this._frameSequence.push(e))}})},image:{get:function(){return this._image},set:function(e){if(e===this._image)return;this._image=e,this._setFrame(this._frame)}},frame:{get:function(){return this._frame},set:function(e){if(e instanceof Array){var t=e,n=t.shift();this._setFrame(n),t.push(n),this._frameSequence=t}else this._setFrame(e),this._frameSequence=[],this._frame=e}},_setFrame:function(e){var t=this._image,n,r;t!=null&&(this._frame=e,n=t.width/this._width|0,this._frameLeft=(e%n|0)*this._width,this._frameTop=(e/n|0)*this._height%t.height)}}),enchant.Sprite.prototype.cvsRender=function(e){var t,n,r,i,s,o,u,a;this._image&&(i=Math.abs(this._frame)||0,t=this._image,n=t._element,s=this._frameLeft,o=Math.min(this._frameTop,t.height-this._height),u=Math.min(t.width-s,this._width),a=Math.min(t.height-o,this._height),e.drawImage(n,s,o,u,a,0,0,this._width,this._height))},enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(e){enchant.Entity.call(this),this.width=300,this.text=e,this.textAlign="left"},text:{get:function(){return this._text},set:function(e){this._text=e}},textAlign:{get:function(){return this._style.textAlign},set:function(e){this._style.textAlign=e}},font:{get:function(){return this._style.font},set:function(e){this._style.font=e}},color:{get:function(){return this._style.color},set:function(e){this._style.color=e}}}),enchant.Label.prototype.cvsRender=function(e){this.text&&(e.textBaseline="top",e.font=this.font,e.fillStyle=this.color||"#000000",e.fillText(this.text,0,0))},enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(e,t){var n=enchant.Game.instance;enchant.Entity.call(this);var r=document.createElement("canvas");r.style.position="absolute",enchant.ENV.RETINA_DISPLAY&&n.scale===2?(r.width=n.width*2,r.height=n.height*2,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(r.width=n.width,r.height=n.height),this._context=r.getContext("2d"),this._tileWidth=e||0,this._tileHeight=t||0,this._image=null,this._data=[[[]]],this._dirty=!1,this._tight=!1,this.touchEnabled=!1,this.collisionData=null,this._listeners.render=null,this.addEventListener("render",function(){if(this._dirty||this._previousOffsetX==null)this._dirty=!1,this.redraw(0,0,n.width,n.height);else if(this._offsetX!==this._previousOffsetX||this._offsetY!==this._previousOffsetY)if(this._tight){var e=-this._offsetX,t=-this._offsetY,r=-this._previousOffsetX,i=-this._previousOffsetY,s=e-r+n.width,o=r-e+n.width,u=t-i+n.height,a=i-t+n.height;if(s>this._tileWidth&&o>this._tileWidth&&u>this._tileHeight&&a>this._tileHeight){var f,l,c,h,p,d;s<o?(f=0,c=r-e,p=s):(f=e-r,c=0,p=o),u<a?(l=0,h=i-t,d=u):(l=t-i,h=0,d=a),n._buffer==null&&(n._buffer=document.createElement("canvas"),n._buffer.width=this._context.canvas.width,n._buffer.height=this._context.canvas.height);var v=n._buffer.getContext("2d");this._doubledImage?(v.clearRect(0,0,p*2,d*2),v.drawImage(this._context.canvas,f*2,l*2,p*2,d*2,0,0,p*2,d*2),v=this._context,v.clearRect(c*2,h*2,p*2,d*2),v.drawImage(n._buffer,0,0,p*2,d*2,c*2,h*2,p*2,d*2)):(v.clearRect(0,0,p,d),v.drawImage(this._context.canvas,f,l,p,d,0,0,p,d),v=this._context,v.clearRect(c,h,p,d),v.drawImage(n._buffer,0,0,p,d,c,h,p,d)),c===0?this.redraw(p,0,n.width-p,n.height):this.redraw(0,0,n.width-p,n.height),h===0?this.redraw(0,d,n.width,n.height-d):this.redraw(0,0,n.width,n.height-d)}else this.redraw(0,0,n.width,n.height)}else this.redraw(0,0,n.width,n.height);this._previousOffsetX=this._offsetX,this._previousOffsetY=this._offsetY})},loadData:function(e){this._data=Array.prototype.slice.apply(arguments),this._dirty=!0,this._tight=!1;for(var t=0,n=this._data.length;t<n;t++){var r=0;e=this._data[t];for(var i=0,s=e.length;i<s;i++)for(var o=0,u=e[i].length;o<u;o++)e[i][o]>=0&&r++;if(r/(e.length*e[0].length)>.2){this._tight=!0;break}}},checkTile:function(e,t){if(e<0||this.width<=e||t<0||this.height<=t)return!1;var n=this._image.width,r=this._image.height,i=this._tileWidth||n,s=this._tileHeight||r;e=e/i|0,t=t/s|0;var o=this._data[0];return o[t][e]},hitTest:function(e,t){if(e<0||this.width<=e||t<0||this.height<=t)return!1;var n=this._image.width,r=this._image.height,i=this._tileWidth||n,s=this._tileHeight||r;e=e/i|0,t=t/s|0;if(this.collisionData!=null)return this.collisionData[t]&&!!this.collisionData[t][e];for(var o=0,u=this._data.length;o<u;o++){var a=this._data[o],f;if(a[t]!=null&&(f=a[t][e])!=null&&0<=f&&f<(n/i|0)*(r/s|0))return!0}return!1},image:{get:function(){return this._image},set:function(e){var t=enchant.Game.instance;this._image=e;if(enchant.ENV.RETINA_DISPLAY&&t.scale===2){var n=new enchant.Surface(e.width*2,e.height*2),r=this._tileWidth||e.width,i=this._tileHeight||e.height,s=e.width/r|0,o=e.height/i|0;for(var u=0;u<o;u++)for(var a=0;a<s;a++)n.draw(e,a*r,u*i,r,i,a*r*2,u*i*2,r*2,i*2);this._doubledImage=n}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(e){this._tileWidth=e,this._dirty=!0}},tileHeight:{get:function(){return this._tileHeight},set:function(e){this._tileHeight=e,this._dirty=!0}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(e,t,n,r){if(this._image==null)return;var i,s,o,u,a;this._doubledImage?(i=this._doubledImage,s=this._tileWidth*2,o=this._tileHeight*2,u=-this._offsetX*2,a=-this._offsetY*2,e*=2,t*=2,n*=2,r*=2):(i=this._image,s=this._tileWidth,o=this._tileHeight,u=-this._offsetX,a=-this._offsetY);var f=i.width/s|0,l=i.height/o|0,c=Math.max((e+u)/s|0,0),h=Math.max((t+a)/o|0,0),p=Math.ceil((e+u+n)/s),d=Math.ceil((t+a+r)/o),v=i._element,m=this._context,g=m.canvas;m.clearRect(e,t,n,r);for(var y=0,b=this._data.length;y<b;y++){var w=this._data[y],E=Math.min(p,w[0].length),S=Math.min(d,w.length);for(t=h;t<S;t++)for(e=c;e<E;e++){var x=w[t][e];if(0<=x&&x<f*l){var T=x%f*s,N=(x/f|0)*o;m.drawImage(v,T,N,s,o,e*s-u,t*o-a,s,o)}}}}}),enchant.Map.prototype.cvsRender=function(e){var t=enchant.Game.instance;e.save(),e.setTransform(1,0,0,1,0,0);var n=this._context.canvas;e.drawImage(n,0,0,t.width,t.height),e.restore()},enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this),this.childNodes=[],this._rotation=0,this._scaleX=1,this._scaleY=1,this._originX=null,this._originY=null,[enchant.Event.ADDED_TO_SCENE,enchant.Event.REMOVED_FROM_SCENE].forEach(function(e){this.addEventListener(e,function(e){this.childNodes.forEach(function(t){t.scene=this.scene,t.dispatchEvent(e)},this)})},this)},addChild:function(e){this.childNodes.push(e),e.parentNode=this;var t=new enchant.Event("childadded");t.node=e,t.next=null,this.dispatchEvent(t),e.dispatchEvent(new enchant.Event("added"));if(this.scene){e.scene=this.scene;var n=new enchant.Event("addedtoscene");e.dispatchEvent(n)}},insertBefore:function(e,t){var n=this.childNodes.indexOf(t);if(n!==-1){this.childNodes.splice(n,0,e),e.parentNode=this;var r=new enchant.Event("childadded");r.node=e,r.next=t,this.dispatchEvent(r),e.dispatchEvent(new enchant.Event("added"));if(this.scene){e.scene=this.scene;var i=new enchant.Event("addedtoscene");e.dispatchEvent(i)}}else this.addChild(e)},removeChild:function(e){var t;if((t=this.childNodes.indexOf(e))!==-1){this.childNodes.splice(t,1),e.parentNode=null;var n=new enchant.Event("childremoved");n.node=e,this.dispatchEvent(n),e.dispatchEvent(new enchant.Event("removed"));if(this.scene){e.scene=null;var r=new enchant.Event("removedfromscene");e.dispatchEvent(r)}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y);for(var e=0,t=this.childNodes.length;e<t;e++)this.childNodes[e]._updateCoordinate();this._dirty=!0},rotation:{get:function(){return this._rotation},set:function(e){this._rotation=e,this._dirty=!0}},scaleX:{get:function(){return this._scaleX},set:function(e){this._scaleX=e,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(e){this._scaleY=e,this._dirty=!0}},originX:{get:function(){return this._originX},set:function(e){this._originX=e,this._dirty=!0}},originY:{get:function(){return this._originY},set:function(e){this._originY=e,this._dirty=!0}}}),function(){enchant.CanvasGroup=enchant.Class.create(enchant.Group,{initialize:function(){var t=enchant.Game.instance,n=this;enchant.Group.call(this),this._cvsCache={matrix:[1,0,0,1,0,0],detectColor:"#000000"},this.width=t.width,this.height=t.height,this._element=document.createElement("canvas"),this._element.width=t.width,this._element.height=t.height,this._element.style.position="absolute",this._detect=document.createElement("canvas"),this._detect.width=t.width,this._detect.height=t.height,this._detect.style.position="absolute",this._lastDetected=0,this.context=this._element.getContext("2d"),this._dctx=this._detect.getContext("2d"),this._colorManager=new o(16,256),enchant.ENV.TOUCH_ENABLED&&(this._element.addEventListener("touchstart",function(e){var t=e.touches;for(var i=0,s=t.length;i<s;i++)e=new enchant.Event("touchstart"),e.identifier=t[i].identifier,e._initPosition(t[i].pageX,t[i].pageY),r.call(n,e)},!1),this._element.addEventListener("touchmove",function(e){var t=e.touches;for(var r=0,s=t.length;r<s;r++)e=new enchant.Event("touchmove"),e.identifier=t[r].identifier,e._initPosition(t[r].pageX,t[r].pageY),i.call(n,e)},!1),this._element.addEventListener("touchend",function(e){var t=e.changedTouches;for(var r=0,i=t.length;r<i;r++)e=new enchant.Event("touchend"),e.identifier=t[r].identifier,e._initPosition(t[r].pageX,t[r].pageY),s.call(n,e)},!1)),this._element.addEventListener("mousedown",function(e){var i=e.pageX,s=e.pageY;e=new enchant.Event("touchstart"),e.identifier=t._mousedownID,e._initPosition(i,s),r.call(n,e),n._mousedown=!0},!1),t._element.addEventListener("mousemove",function(e){if(!n._mousedown)return;var r=e.pageX,s=e.pageY;e=new enchant.Event("touchmove"),e.identifier=t._mousedownID,e._initPosition(r,s),i.call(n,e)},!1),t._element.addEventListener("mouseup",function(e){if(!n._mousedown)return;var r=e.pageX,i=e.pageY;e=new enchant.Event("touchend"),e.identifier=t._mousedownID,e._initPosition(r,i),s.call(n,e),n._mousedown=!1},!1);var u=[enchant.Event.ENTER,enchant.Event.ADDED_TO_SCENE],a=[enchant.Event.EXIT,enchant.Event.REMOVED_FROM_SCENE];u.forEach(function(t){this.addEventListener(t,this._startRendering),this.addEventListener(t,function(){e.push(this)})},this),a.forEach(function(t){this.addEventListener(t,this._stopRendering),this.addEventListener(t,function(){var t=e.indexOf(this);t!==-1&&e.splice(t,1)})},this);var f=function(e){var t=e.node;t.childNodes&&(t.addEventListener("childadded",f),t.addEventListener("childremoved",l)),w.call(t,n._colorManager),m.call(t,n.context)},l=function(e){var t=e.node;t.childNodes&&(t.removeEventListener("childadded",f),t.removeEventListener("childremoved",l)),E.call(t,n._colorManager)};this.addEventListener("childremoved",l),this.addEventListener("childadded",f),this._onexitframe=function(){var e=n.context;e.clearRect(0,0,t.width,t.height),m.call(n,e)}},_startRendering:function(){var e=enchant.Game.instance;e._listeners.exitframe||(e._listeners.exitframe=[]),e._listeners.exitframe.push(this._onexitframe)},_stopRendering:function(){var e=enchant.Game.instance;e.removeEventListener("exitframe",this._onexitframe)},_getEntityByPosition:function(e,t){var n=enchant.Game.instance,r=this._dctx;this._lastDetected<n.frame&&(r.clearRect(0,0,this.width,this.height),b.call(this,r),this._lastDetected=n.frame);var i=r.getImageData(e,t,1,1).data;return this._colorManager.getSpriteByColor(i)},_touchstartPropagation:function(e){return this._touching=this._getEntityByPosition(e.x,e.y),this._touching?S.call(this._touching,e,this.parentNode):(this._touching=enchant.Game.instance.currentScene,this._touching.dispatchEvent(e)),this._touching},_touchmovePropagation:function(e){S.call(this._touching,e,this.parentNode)},_touchendPropagation:function(e){S.call(this._touching,e,this.parentNode),this._touching=null}});var e=[],t=null,n=null,r=function(r){var i=enchant.Game.instance,s;for(var o=e.length-1;o>=0;o--){s=e[o];if(s.scene!==i.currentScene)continue;var u=s._touchstartPropagation(r);if(u){t=u,n=s;return}}},i=function(e){n!=null&&n._touchmovePropagation(e)},s=function(e){n!=null&&(n._touchendPropagation(e),t=null,n=null)},o=enchant.Class.create({initialize:function(e,t){this.reference=[],this.detectColorNum=0,this.colorResolution=e||16,this.max=t||1},attachDetectColor:function(e){return this.detectColorNum+=1,this.reference[this.detectColorNum]=e,this._createNewColor()},detachDetectColor:function(e){var t=this.reference.indexOf(e);t!==-1&&(this.reference[t]=null)},_createNewColor:function(){var e=this.detectColorNum,t=this.colorResolution,n=t/this.max;return[parseInt(e/t/t%t,10)/n,parseInt(e/t%t,10)/n,parseInt(e%t,10)/n,1]},_decodeDetectColor:function(e){var t=this.colorResolution;return~~(e[0]*t*t*t/256)+~~(e[1]*t*t/256)+~~(e[2]*t/256)},getSpriteByColor:function(e){return this.reference[this._decodeDetectColor(e)]}}),u=function(e,t){e=e||function(){},t=t||function(){};var n=function(){e.apply(this,arguments);var r;if(this.childNodes)for(var i=0,s=this.childNodes.length;i<s;i++)r=this.childNodes[i],n.apply(r,arguments);t.apply(this,arguments)};return n},a=function(e,t){var n=e._x,r=e._y,i=e._width||0,s=e._height||0,o=e._rotation||0,u=typeof e._scaleX=="number"?e._scaleX:1,a=typeof e._scaleY=="number"?e._scaleY:1,f=o*Math.PI/180,l=Math.cos(f),c=Math.sin(f),h=typeof e._originX=="number"?e._originX:i/2,p=typeof e._originY=="number"?e._originY:s/2,d=u*l,v=u*c,m=a*c,g=a*l;t[0]=d,t[1]=v,t[2]=-m,t[3]=g,t[4]=-d*h+m*p+n+h,t[5]=-v*h-g*p+r+p},f=function(e,t){t.alphaBlending?e.globalCompositeOperation=t.alphaBlending:e.globalCompositeOperation="source-over",e.globalAlpha=typeof t.opacity=="number"?t.opacity:1},l=function(e,t,n){var r=e[0],i=e[2],s=e[4],o=e[1],u=e[3],a=e[5],f=t[0],l=t[2],c=t[4],h=t[1],p=t[3],d=t[5];n[0]=r*f+i*h,n[1]=o*f+u*h,n[2]=r*l+i*p,n[3]=o*l+u*p,n[4]=r*c+i*d+s,n[5]=o*c+u*d+a},c=function(e,t,n){var r=t[0],i=t[1],s=e[0],o=e[2],u=e[4],a=e[1],f=e[3],l=e[5];n[0]=s*r+o*i+u,n[1]=a*r+f*i+l},h=[[1,0,0,1,0,0]],p=function(e){var t=[];l(h[h.length-1],e,t),h.push(t)},d=function(e,t){t._dirty&&a(t,t._cvsCache.matrix),p(t._cvsCache.matrix);var n=h[h.length-1];e.setTransform.apply(e,n);var r=typeof t._originX=="number"?t._originX:t._width/2||0,i=typeof t._originY=="number"?t._originY:t._height/2||0,s=[r,i];c(n,s,s),t._offsetX=s[0]-r,t._offsetY=s[1]-i,t._dirty=!1},v=function(e,t){var n=enchant.Game.instance;if(typeof t.visible!="undefined"&&!t.visible)return;t.backgroundColor&&(e.fillStyle=t.backgroundColor,e.fillRect(0,0,t.width,t.height)),t.cvsRender&&t.cvsRender(e),n._debug&&(t instanceof enchant.Label||t instanceof enchant.Sprite?e.strokeStyle="#ff0000":e.strokeStyle="#0000ff",e.strokeRect(0,0,t.width,t.height))},m=u(function(e){e.save(),f(e,this),d(e,this),v(e,this)},function(e){e.restore(),h.pop()}),g=function(e){return"#"+("00"+Number(parseInt(e[0],10)).toString(16)).slice(-2)+("00"+Number(parseInt(e[1],10)).toString(16)).slice(-2)+("00"+Number(parseInt(e[2],10)).toString(16)).slice(-2)},y=function(e,t){e.fillStyle=t._cvsCache.detectColor,e.fillRect(0,0,t.width,t.height)},b=u(function(e){e.save(),d(e,this),y(e,this)},function(e){e.restore(),h.pop()}),w=u(function(e){this._cvsCache||(this._cvsCache={},this._cvsCache.matrix=[1,0,0,1,0,0],this._cvsCache.detectColor=g(e.attachDetectColor(this)))}),E=u(function(e){this._cvsCache&&(e.detachDetectColor(this),delete this._cvsCache)}),S=function(e,t){this.dispatchEvent(e)}}(),enchant.CanvasScene=enchant.Class.create(enchant.CanvasGroup,{initialize:function(){enchant.CanvasGroup.call(this),this.scene=this,this._element.style[enchant.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0",this._element.style[enchant.ENV.VENDOR_PREFIX+"Transform"]="scale("+enchant.Game.instance.scale+")"},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e}},_updateCoordinate:function(){this._offsetX=this._x,this._offsetY=this._y;for(var e=0,t=this.childNodes.length;e<t;e++)this.childNodes[e]._updateCoordinate();this._dirty=!0}}),enchant.Scene=enchant.CanvasScene,enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(e,t){enchant.EventTarget.call(this);var n=enchant.Game.instance;this.width=e,this.height=t,this.context=null;var r="enchant-surface"+n._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",r,e,t),this._element=this.context.canvas,this._css="-webkit-canvas("+r+")";var i=this.context}else document.mozSetImageElement?(this._element=document.createElement("canvas"),this._element.width=e,this._element.height=t,this._css="-moz-element(#"+r+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(r,this._element)):(this._element=document.createElement("canvas"),this._element.width=e,this._element.height=t,this._element.style.position="absolute",this.context=this._element.getContext("2d"),enchant.ENV.CANVAS_DRAWING_METHODS.forEach(function(e){var t=this.context[e];this.context[e]=function(){t.apply(this,arguments),this._dirty=!0}},this))},getPixel:function(e,t){return this.context.getImageData(e,t,1,1).data},setPixel:function(e,t,n,r,i,s){var o=this.context.createImageData(1,1);o.data[0]=n,o.data[1]=r,o.data[2]=i,o.data[3]=s,this.context.putImageData(o,e,t)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(e){e=e._element;if(arguments.length===1)this.context.drawImage(e,0,0);else{var t=arguments;t[0]=e,this.context.drawImage.apply(this.context,t)}},clone:function(){var e=new enchant.Surface(this.width,this.height);return e.draw(this),e},toDataURL:function(){var e=this._element.src;return e?e.slice(0,5)==="data:"?e:this.clone().toDataURL():this._element.toDataURL()}}),enchant.Surface.load=function(e){var t=new Image,n=Object.create(enchant.Surface.prototype,{context:{value:null},_css:{value:"url("+e+")"},_element:{value:t}});return enchant.EventTarget.call(n),t.src=e,t.onerror=function(){throw new Error("Cannot load an asset: "+t.src)},t.onload=function(){n.width=t.width,n.height=t.height,n.dispatchEvent(new enchant.Event("load"))},n},enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){throw enchant.EventTarget.call(this),this.duration=0,new Error("Illegal Constructor")},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause(),this.currentTime=0},clone:function(){var e;if(this._element instanceof Audio)e=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(!1)},duration:{value:this.duration}});else{if(enchant.ENV.USE_FLASH_SOUND)return this;e=Object.create(enchant.Sound.prototype)}return enchant.EventTarget.call(e),e},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(e){this._element&&(this._element.currentTime=e)}},volume:{get:function(){return this._element?this._element.volume:1},set:function(e){this._element&&(this._element.volume=e)}}}),enchant.Sound.load=function(e,t){if(t==null){var n=enchant.Game.findExt(e);n?t="audio/"+n:t=""}t=t.replace("mp3","mpeg").replace("m4a","mp4");var r=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(r);var i=new Audio;if(!enchant.Sound.enabledInMobileSafari&&enchant.ENV.VENDOR_PREFIX==="webkit"&&enchant.ENV.TOUCH_ENABLED)window.setTimeout(function(){r.dispatchEvent(new enchant.Event("load"))},0);else if(!enchant.ENV.USE_FLASH_SOUND&&i.canPlayType(t))i.src=e,i.load(),i.autoplay=!1,i.onerror=function(){throw new Error("Cannot load an asset: "+i.src)},i.addEventListener("canplaythrough",function(){r.duration=i.duration,r.dispatchEvent(new enchant.Event("load"))},!1),r._element=i;else if(t==="audio/mpeg"){var s=document.createElement("embed"),o="enchant-audio"+enchant.Game.instance._soundID++;s.width=s.height=1,s.name=o,s.src="sound.swf?id="+o+"&src="+e,s.allowscriptaccess="always",s.style.position="absolute",s.style.left="-1px",r.addEventListener("load",function(){Object.defineProperties(s,{currentTime:{get:function(){return s.getCurrentTime()},set:function(e){s.setCurrentTime(e)}},volume:{get:function(){return s.getVolume()},set:function(e){s.setVolume(e)}}}),r._element=s,r.duration=s.getDuration()}),enchant.Game.instance._element.appendChild(s),enchant.Sound[o]=r}else window.setTimeout(function(){r.dispatchEvent(new enchant.Event("load"))},0);return r},enchant.Sound.enabledInMobileSafari=!1,enchant.ActionEventTarget=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.apply(this,arguments)},dispatchEvent:function(e){var t;this.node?(t=this.node,e.target=t,e.localX=e.x-t._offsetX,e.localY=e.y-t._offsetY):this.node=null,this["on"+e.type]!=null&&this["on"+e.type].call(t,e);var n=this._listeners[e.type];if(n!=null){n=n.slice();for(var r=0,i=n.length;r<i;r++)n[r].call(t,e)}}}),enchant.Action=enchant.Class.create(enchant.ActionEventTarget,{initialize:function(e){enchant.ActionEventTarget.call(this),this.time=null,this.frame=0;for(var t in e)e.hasOwnProperty(t)&&e[t]!=null&&(this[t]=e[t]);var n=this;this.timeline=null,this.node=null,this.addEventListener(enchant.Event.ADDED_TO_TIMELINE,function(e){n.timeline=e.timeline,n.node=e.timeline.node,n.frame=0}),this.addEventListener(enchant.Event.REMOVED_FROM_TIMELINE,function(){n.timeline=null,n.node=null,n.frame=0}),this.addEventListener(enchant.Event.ACTION_TICK,function(e){var t=n.time-(n.frame+e.elapsed);n.time!=null&&t<=0?(n.frame=n.time,e.timeline.next(-t)):n.frame+=e.elapsed})}}),enchant.Tween=enchant.Class.create(enchant.Action,{initialize:function(e){var t={},n={};enchant.Action.call(this,e),this.easing==null&&(this.easing=function(e,t,n,r){return n*e/r+t});var r=this;this.addEventListener(enchant.Event.ACTION_START,function(){var i=["frame","time","callback","onactiontick","onactionstart","onactionend"];for(var s in e)if(e.hasOwnProperty(s)){var o;typeof e[s]=="function"?o=e[s].call(r.node):o=e[s],i.indexOf(s)===-1&&(t[s]=r.node[s],n[s]=o)}}),this.addEventListener(enchant.Event.ACTION_TICK,function(e){var i=r.easing(Math.min(r.time,r.frame+e.elapsed),0,1,r.time)-r.easing(r.frame,0,1,r.time);for(var s in n)if(n.hasOwnProperty(s)){if(typeof this[s]=="undefined")continue;r.node[s]+=(n[s]-t[s])*i,Math.abs(r.node[s])<1e-7&&(r.node[s]=0)}})}}),enchant.Timeline=enchant.Class.create(enchant.EventTarget,{initialize:function(e,t){enchant.EventTarget.call(this),this.node=e,this.queue=[],this.paused=!1,this.looped=!1,this.isFrameBased=!0,this._parallel=null,this._initialized=!t,this.addEventListener(enchant.Event.ENTER_FRAME,this.tick)},setFrameBased:function(){this.isFrameBased=!0},setTimeBased:function(){this.isFrameBased=!1},next:function(e){var t,n=this.queue.shift();t=new enchant.Event("actionend"),t.timeline=this,n.dispatchEvent(t),this.looped?(t=new enchant.Event("removedfromtimeline"),t.timeline=this,n.dispatchEvent(t),n.frame=0,this.add(n)):(t=new enchant.Event("removedfromtimeline"),t.timeline=this,n.dispatchEvent(t));var r=new enchant.Event("enterframe");r.elapsed=Math.max(e,1),this.dispatchEvent(r)},tick:function(e){if(this.paused)return;if(this.queue.length>0){var t=this.queue[0];if(t.frame===0){var n;n=new enchant.Event("actionstart"),n.timeline=this,t.dispatchEvent(n)}var r=new enchant.Event("actiontick");r.timeline=this,this.isFrameBased?r.elapsed=1:r.elapsed=e.elapsed,t.dispatchEvent(r)}},add:function(e){if(!this._initialized){var t=this;this.node.addEventListener("enterframe",function(e){t.dispatchEvent(e)}),this._initialized=!0}this._parallel?(this._parallel.actions.push(e),this._parallel=null):this.queue.push(e),e.frame=0;var n=new enchant.Event("addedtotimeline");return n.timeline=this,e.dispatchEvent(n),n=new enchant.Event("actionadded"),n.action=e,this.dispatchEvent(n),this},action:function(e){return this.add(new enchant.Action(e))},tween:function(e){return this.add(new enchant.Tween(e))},clear:function(){var e=new enchant.Event("removedfromtimeline");e.timeline=this;for(var t=0,n=this.queue.length;t<n;t++)this.queue[t].dispatchEvent(e);return this.queue=[],this},skip:function(e){var t=new enchant.Event("enterframe");this.isFrameBased?t.elapsed=1:(t.elapsed=e,e=1);while(e--)this.dispatchEvent(t);return this},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this},loop:function(){return this.looped=!0,this},unloop:function(){return this.looped=!1,this},delay:function(e){return this.add(new enchant.Action({time:e})),this},wait:function(e){return this},then:function(e){var t=this;return this.add(new enchant.Action({onactiontick:function(n){e.call(t.node),t.next(n.elapsed)}})),this},exec:function(e){this.then(e)},cue:function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&(this.delay(n-t),this.then(e[n]),t=n)},repeat:function(e,t){return this.add(new enchant.Action({onactiontick:function(t){e.call(this)},time:t})),this},and:function(){var e=this.queue.pop();if(e instanceof enchant.ParallelAction)this._parallel=e,this.queue.push(e);else{var t=new enchant.ParallelAction;t.actions.push(e),this.queue.push(t),this._parallel=t}return this},or:function(){return this},doAll:function(e){return this},waitAll:function(){return this},waitUntil:function(e){var t=this;return this.add(new enchant.Action({onactionstart:e,onactiontick:function(n){e.call(this)&&t.next()}})),this},fadeTo:function(e,t,n){return this.tween({opacity:e,time:t,easing:n}),this},fadeIn:function(e,t){return this.fadeTo(1,e,t)},fadeOut:function(e,t){return this.fadeTo(0,e,t)},moveTo:function(e,t,n,r){return this.tween({x:e,y:t,time:n,easing:r})},moveX:function(e,t,n){return this.tween({x:e,time:t,easing:n})},moveY:function(e,t,n){return this.tween({y:e,time:t,easing:n})},moveBy:function(e,t,n,r){return this.tween({x:function(){return this.x+e},y:function(){return this.y+t},time:n,easing:r})},hide:function(){return this.then(function(){this.opacity=0})},show:function(){return this.then(function(){this.opacity=1})},removeFromScene:function(){return this.then(function(){this.scene.removeChild(this)})},scaleTo:function(e,t,n){return typeof n=="number"?this.tween({scaleX:arguments[0],scaleY:arguments[1],time:arguments[2],easing:arguments[3]}):this.tween({scaleX:e,scaleY:e,time:t,easing:n})},scaleBy:function(e,t,n){return typeof n=="number"?this.tween({scaleX:function(){return this.scaleX*arguments[0]},scaleY:function(){return this.scaleY*arguments[1]},time:arguments[2],easing:arguments[3]}):this.tween({scaleX:function(){return this.scaleX*e},scaleY:function(){return this.scaleY*e},time:t,easing:n})},rotateTo:function(e,t,n){return this.tween({rotation:e,time:t,easing:n})},rotateBy:function(e,t,n){return this.tween({rotation:function(){return this.rotation+e},time:t,easing:n})}}),enchant.Easing={LINEAR:function(e,t,n,r){return n*e/r+t},SWING:function(e,t,n,r){return n*(.5-Math.cos(e/r*Math.PI)/2)+t},QUAD_EASEIN:function(e,t,n,r){return n*(e/=r)*e+t},QUAD_EASEOUT:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},QUAD_EASEINOUT:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},CUBIC_EASEIN:function(e,t,n,r){return n*(e/=r)*e*e+t},CUBIC_EASEOUT:function(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t},CUBIC_EASEINOUT:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t},QUART_EASEIN:function(e,t,n,r){return n*(e/=r)*e*e*e+t},QUART_EASEOUT:function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},QUART_EASEINOUT:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t},QUINT_EASEIN:function(e,t,n,r){return n*(e/=r)*e*e*e*e+t},QUINT_EASEOUT:function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t},QUINT_EASEINOUT:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},SIN_EASEIN:function(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t},SIN_EASEOUT:function(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t},SIN_EASEINOUT:function(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t},CIRC_EASEIN:function(e,t,n,r){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t},CIRC_EASEOUT:function(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t},CIRC_EASEINOUT:function(e,t,n,r){return(e/=r/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t},ELASTIC_EASEIN:function(e,t,n,r,i,s){if(e===0)return t;if((e/=r)===1)return t+n;s||(s=r*.3);var o;return!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t},ELASTIC_EASEOUT:function(e,t,n,r,i,s){if(e===0)return t;if((e/=r)===1)return t+n;s||(s=r*.3);var o;return!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t},ELASTIC_EASEINOUT:function(e,t,n,r,i,s){if(e===0)return t;if((e/=r/2)===2)return t+n;s||(s=r*.3*1.5);var o;return!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),e<1?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t},BOUNCE_EASEOUT:function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},BOUNCE_EASEIN:function(e,t,n,r){return n-enchant.Easing.BOUNCE_EASEOUT(r-e,0,n,r)+t},BOUNCE_EASEINOUT:function(e,t,n,r){return e<r/2?enchant.Easing.BOUNCE_EASEIN(e*2,0,n,r)*.5+t:enchant.Easing.BOUNCE_EASEOUT(e*2-r,0,n,r)*.5+n*.5+t},BACK_EASEIN:function(e,t,n,r,i){return i===undefined&&(i=1.70158),n*(e/=r)*e*((i+1)*e-i)+t},BACK_EASEOUT:function(e,t,n,r,i){return i===undefined&&(i=1.70158),n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},BACK_EASEINOUT:function(e,t,n,r,i){return i===undefined&&(i=1.70158),(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},EXPO_EASEIN:function(e,t,n,r){return e===0?t:n*Math.pow(2,10*(e/r-1))+t},EXPO_EASEOUT:function(e,t,n,r){return e===r?t+n:n*(-Math.pow(2,-10*e/r)+1)+t},EXPO_EASEINOUT:function(e,t,n,r){return e===0?t:e===r?t+n:(e/=r/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t}};